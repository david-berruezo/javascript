<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Rotate 2</title>
    <link rel="stylesheet" href="../include/style.css">
</head>
<body>
<header>
    Example from <a href="http://amzn.com/1430236655?tag=html5anim-20"><em>Foundation HTML5 Animation with JavaScript</em></a>
</header>
<canvas id="canvas" width="400" height="400"></canvas>
<script>

    window.onload = function () {

        // Object
        function Point3d (x, y, z) {
            this.x = (x === undefined) ? 0 : x;
            this.y = (y === undefined) ? 0 : y;
            this.z = (z === undefined) ? 0 : z;
            this.fl = 550;
            this.vpX = 0;
            this.vpY = 0;
            this.cX = 0;
            this.cY = 0;
            this.cZ = 0;
        }

        Point3d.prototype.setVanishingPoint = function (vpX, vpY) {
            this.vpX = vpX;
            this.vpY = vpY;
        };

        Point3d.prototype.setCenter = function (cX, cY, cZ) {
            this.cX = cX;
            this.cY = cY;
            this.cZ = cZ;
        };

        Point3d.prototype.rotateX = function (angleX) {
            y1 = this.y * Math.cos(angleX) - this.z * Math.sin(angleX),
                z1 = this.z * Math.cos(angleX) + this.y * Math.sin(angleX);
            this.y = y1;
            this.z = z1;
        };

        Point3d.prototype.rotateY = function (angleY) {
            x1 = this.x * Math.cos(angleY) - this.z * Math.sin(angleY),
                z1 = this.z * Math.cos(angleY) + this.x * Math.sin(angleY);
            this.x = x1;
            this.z = z1;
        };

        Point3d.prototype.rotateZ = function (angleZ) {
            x1 = this.x * Math.cos(angleZ) - this.y * Math.sin(angleZ),
                y1 = this.y * Math.cos(angleZ) + this.x * Math.sin(angleZ);
            this.x = x1;
            this.y = y1;
        };

        Point3d.prototype.getScreenX = function () {
            var scale = this.fl / (this.fl + this.z + this.cZ);
            return this.vpX + (this.cX + this.x) * scale;
        };

        Point3d.prototype.getScreenY = function () {
            var scale = this.fl / (this.fl + this.z + this.cZ);
            return this.vpY + (this.cY + this.y) * scale;
        };

        Point3d.prototype.formulaX = function () {
            var x1 = this.x - centerX,
                x2 = cos * x1 - sin * (this.y - centerY);
            return x2;
        };

        Point3d.prototype.formulaY = function () {
            var y1 = this.y - centerY,
                y2 = cos * y1 + sin * (this.x - centerX);
            return y2;
        };

        var canvas = document.getElementById('canvas'),
            context = canvas.getContext('2d'),
            vr = 0.05,
            cos = Math.cos(vr),
            sin = Math.sin(vr),
            centerX = canvas.width / 2,
            centerY = canvas.height / 2,
            points = new Array(),
            num_points = 10,
            angleTotal;

        angleTotal = 0;

        for (var i=0;i<num_points;i++){
            points[i] = new Point3d(Math.random() * canvas.width,Math.random() * canvas.height,0);
        }

        function dibujar_bola(x,y){
            context.save();
            context.translate(0, 0);
            context.rotate(0);
            context.scale(1, 1);
            context.lineWidth = 1;
            context.fillStyle = "#ff0000";
            context.beginPath();
            //x, y, radius, start_angle, end_angle, anti-clockwise
            context.arc(x, y, 30, 0, (Math.PI * 2), true);
            context.closePath();
            context.fill();
            if (this.lineWidth > 0) {
                context.stroke();
            }
            context.restore();
        }

        (function drawFrame () {
            window.requestAnimationFrame(drawFrame, canvas);
            context.clearRect(0, 0, canvas.width, canvas.height);
            if (angleTotal < Math.PI * 2){
                console.log("Entra 1");
                angleTotal = angleTotal + vr;
            }else{
                console.log("Entra 2");
                cos = Math.cos(0);
                sin = Math.sin(0);
            }
            for (var i=0;i<num_points;i++){
                var x = points[i].formulaX();
                var y = points[i].formulaY();
                points[i].x = centerX + x;
                points[i].y = centerY + y;
                dibujar_bola(points[i].x,points[i].y);
            }
        }());
    };
</script>
</body>
</html>
