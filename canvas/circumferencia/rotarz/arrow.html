<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Rotate to Mouse</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<canvas id="canvas" width="400" height="400"></canvas>
<script src="Librerias/utils/utils.js"></script>
<script src="arrow.js"></script>
<script>
window.onload = function () {
    var canvas = document.getElementById('canvas'),
    context = canvas.getContext('2d'),
    mouse = captureMouse(canvas),
    arrow = new Arrow();
    arrow.x = 150;
    arrow.y = 150;
    var margenX     = 150;
    var margenY     = 150;
    var radio	    = 100;
    var grados      = 0;
    var adjRatio    = 0;
    var oppRatio    = 0;
    var tempGrados  = 0;
    var tempGrados2 = 0;
    var contadorVueltas = 0;
    var ball = new Ball(10);
    ball.x = 250;
    ball.y = 150;
    //var vr = 0.0174;
    var vr = 0.0;
    var cos = Math.cos(vr);
    var sin = Math.sin(vr);
    var dx2 = 0;
    var dy2 = 0;
    var scale = 1;

    (function drawFrame () {
        if (contadorVueltas == 0){
            if (grados > 360){

                grados = 360 - grados;
                contadorVueltas ++;
            }
            adjRatio = margenX + radio * Math.cos(grados*(Math.PI/180)); // CAH
            oppRatio = margenY + radio * Math.sin(grados*(Math.PI/180)); // SOH
            window.requestAnimationFrame(drawFrame, canvas);
            context.clearRect(0, 0, canvas.width, canvas.height);
            var dx = adjRatio - arrow.x;
            var dy = oppRatio - arrow.y;
            dx2 = adjRatio - ball.x;
            dy2 = oppRatio - ball.y;
            context.globalAlpha = 1;
            arrow.rotation = Math.atan2(dy, dx); //radians
            arrow.draw(context);
            tempGrados  = Math.atan2(dy, dx) * 180 / Math.PI;
            tempGrados2 = Math.atan2(dy2, dx2) * 180 / Math.PI;
            if (Math.sin(grados*(Math.PI/180)) >= 0 && Math.sin(grados*(Math.PI/180)) <= 180 ){
                scale = 1 + Math.abs(Math.sin(grados*(Math.PI/180)));
            }else{
                scale = 1 - Math.abs(Math.sin(grados*(Math.PI/180))) / 2;
            }
            if (tempGrados < 0 ){
                tempGrados = 360 + tempGrados;
            }
            if (tempGrados2 < 0 ){
                tempGrados2 = 360 + tempGrados2;
            }
            //context.globalAlpha = 0;
            // canvas
            context.save();
            context.translate(adjRatio,margenY);
            //context.rotate(grados * Math.PI/180);
            context.scale(scale,scale);
            context.fillStyle='0x000000';
            context.fillRect(-20/2, -20/2, 20, 20);
            context.restore();
            var x1 = ball.x - margenX,
            y1 = ball.y - margenY,
            x2 = x1 * cos - y1 * sin,
            y2 = y1 * cos + x1 * sin;
            ball.x = margenX + x2;
            ball.y = margenY + y2;
            //centerX+=0.1;
            ball.rotation = Math.atan2(dy, dx); //radians
            ball.draw(context);
            console.log('sin: '+Math.sin(grados*(Math.PI/180))+' grados: '+Math.atan2(dy, dx) * 180 / Math.PI+' tempGrados: '+tempGrados+' tempGrados2: '+tempGrados2);
            grados = grados + 1;
        }
    }());
};
</script>
</body>
</html>