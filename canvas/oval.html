<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Oval</title>
<script src="Librerias/jquery.js"></script>
<script src="Librerias/utils/utils.js"></script>
<script src="animationClass.js"></script>
<script src="Events.js"></script>
</head>
<body>
<canvas id="canvas" width="800" height="600" style="border:1px solid #cccccc;"></canvas>
<script>
window.onload = function () {
	
	var canvas = document.getElementById('canvas'),
	context = canvas.getContext('2d'),
	radioX = 300,
	radioY = 100,
	radio  = 400,
	margenX = 400,
	margenY = 300,
	contadorGrados = 0,
	adjRatio = 0,
	oppRatio = 0,
	scale	 = 1,
	alpha	 = 1,
	idPinchado = 0,
	estadoAplicacion = 'inicial',
	idSeleccionado = 0,
	vectorProyectos = new Array(),
	vectorObjetoFotos = new Array(),
	diferenciaGrados = 0,
	stageWidth = window.innerWidth,
	stageHeight = window.innerHeight,
	vectorObjetos = new Array(),
	//events  = new Events("canvas"),
	message = "",
	anim = new Animation(canvas);
	//mouseX = 0,
	//mouseY = 0;
	
	// Funciones
	configuration();
	llenarObjetoProyectos();
	leerProyectos();
	guardarAngulos();
	cargarFotos();
	
	
	anim.setStage(function(){
		
		// update
		/*
		var linearDistEachFrame = linearSpeed * this.
		getTimeInterval() / 1000;
		
		if (box.x < canvas.width - box.width) {
			box.x += linearDistEachFrame;
		}else {
			anim.stop();
		}
		*/
		
		// clear
		this.clear();
		
		// draw
		/*
		context.beginPath();
		context.fillStyle = "blue";
		context.fillRect(box.x, box.y, box.width, box.height);
		*/
		circumferencia();
		
	});
	
	//anim.start();
	
	function configuration(){
		
		//events.listen();
		
		// Tamañano del stage
		canvas.width  = 800;
		canvas.height = 600;
		
		// Capturar Mouse y eventos click
		mouse = captureMouse(canvas);
		
		canvas.addEventListener('click',clickGrade,true);
		
	}
	
	// Llenamos objeto Proyectos con imagenes y detalle de nuestro proyecto
	function llenarObjetoProyectos(){
		
		var miProyecto = '';
		
		// eCommerce
		miProyecto = new objetoProyecto(1,'eCommerce Barcelona 360','http://www.ecommercebarcelona360.com');
		miProyecto.imagenesListado[0]= 'http://localhost/javascript/ecommerce/img/ecommerce/imagenesListado/1.jpg';
		miProyecto.imagenesListado[1]= 'http://localhost/javascript/ecommerce/img/ecommerce/imagenesListado/2.jpg';
		miProyecto.imagenesListado[2]= 'http://localhost/javascript/ecommerce/img/ecommerce/imagenesListado/3.jpg';
		miProyecto.imagenesListado[3]= 'http://localhost/javascript/ecommerce/img/ecommerce/imagenesListado/4.jpg';
		miProyecto.imagenesListado[4]= 'http://localhost/javascript/ecommerce/img/ecommerce/imagenesListado/5.jpg';
		miProyecto.imagenesListado[5]= 'http://localhost/javascript/ecommerce/img/ecommerce/imagenesListado/6.jpg';
		
			
		miProyecto.imagenesCabecera[0]= 'http://localhost/javascript/ecommerce/img/ecommerce/cabecera/listado1.jpg';
		miProyecto.imagenesCabecera[1]= 'http://localhost/javascript/ecommerce/img/ecommerce/cabecera/listado2.jpg';
		miProyecto.imagenesCabecera[2]= 'http://localhost/javascript/ecommerce/img/ecommerce/cabecera/listado3.jpg';
		miProyecto.imagenesCabecera[3]= 'http://localhost/javascript/ecommerce/img/ecommerce/cabecera/listado4.jpg';
		miProyecto.imagenesCabecera[4]= 'http://localhost/javascript/ecommerce/img/ecommerce/cabecera/listado5.jpg';
		miProyecto.imagenesCabecera[5]= 'http://localhost/javascript/ecommerce/img/ecommerce/cabecera/listado6.jpg';
		miProyecto.imagenesCabecera[6]= 'http://localhost/javascript/ecommerce/img/ecommerce/cabecera/listado7.jpg';
		miProyecto.imagenesCabecera[7]= 'http://localhost/javascript/ecommerce/img/ecommerce/cabecera/listado8.jpg';
		
		
		vectorProyectos.push(miProyecto);
		
	}
	
	function guardarAngulos(){
		
		for (var i=0; i < 8; i++){
			
			contadorGrados = i * (360 / 8);
			
			adjRatio = margenX + radioX * Math.cos(contadorGrados*(Math.PI/180)); // CAH
			oppRatio = margenY + radioY * Math.sin(contadorGrados*(Math.PI/180)); // SOH
				
			vectorObjetos.push(new Cuadrado({
				
				x: adjRatio,
				y: oppRatio,
				angle: contadorGrados,
				z: i,
				width:80,
				height:40,
				imagen:'img',
				rotation:0,
				radioX:radioX,
				radioY:radioY,
				margenX:margenX,
				margenY:margenY,
				scaleX:1,
				scaleY:1,
				alpha:1
				
			}));
			
			console.log('grados: '+contadorGrados + 'i: '+i);
			
		}
		
		contadorGrados = 0;
		
	}	
	
	function clickGrade(){
		
		if (vectorObjetos[idSeleccionado].angle > 90){
			
			diferenciaGrados = 360 - vectorObjetos[idSeleccionado].angle + 90;
		
			
		}else{
			
			diferenciaGrados = 90 - vectorObjetos[idSeleccionado].angle;
			
		}
		
		console.log('pinchado: '+idSeleccionado+'diferencia grados: '+diferenciaGrados);
		
		//finalizarEventos = true;
		idPinchado       = idSeleccionado;
		estadoAplicacion = 'seleccionado';
		idSeleccionado   = -1;
		contadorGrados   = 0;
		//console.log('diferenciaGrados: '+diferenciaGrados+' idSeleccionado: '+idSeleccionado);
	
		
	}// End function
	
	function circumferencia(){
		
		var detectado   = false;
	
		for (var i = 0; i < vectorObjetos.length; i++ ){
			
			vectorObjetos[i].draw(context);
			
			//console.log('mouseX: '+mouse.x);
			//console.log('mouseY: '+mouse.y);
			//var objetito = vectorObjetos[i].getBounds();
			//console.log('objetotoX: '+objetito.x+'objetitoY: '+objetito.y+'mouseX: '+mouse.x+' mouse.y: '+mouse.y);
			
			if (vectorObjetos[i].containsPoint(vectorObjetos[i].getBounds(), mouse.x, mouse.y)) {
				
				console.log("in ball: mousemove"+i);
				idSeleccionado = i;
				detectado = true;
				
				
			} else {
				
				//console.log("canvas: mousemove"+i);
			}
			
			
			
				
				//mouseEncima = comprobarPosicion(i);
				
				
				
			
		
		}
		
		if (detectado == false){
			
			$('canvas').css('cursor','default');
			sumarGrados();
			
		}else{
			
			$('canvas').css('cursor','pointer');
			
		}
		
		
	}
	
	

	function sumarGrados(){
		
		var estado = 'corriendo';
		
		for (var i = 0; i < vectorObjetos.length; i++ ){
			
			if (estadoAplicacion == 'seleccionado'){
				
				if (diferenciaGrados > contadorGrados){
					
					vectorObjetos[i].angle = vectorObjetos[i].angle + 1;
				
				}else{
					
					estado = 'parado';
					
				}
				
			}else{
				
				vectorObjetos[i].angle = vectorObjetos[i].angle + 1;
				
			}
			
			
			if (vectorObjetos[i].angle > 360 ){
				
				vectorObjetos[i].angle = vectorObjetos[i].angle - 360; 
				
			}
			
		}
		
		if (estado == 'corriendo'){
			
			contadorGrados++;
			
		}
		
		
		
	}
	
	function leerProyectos(){
		
		//console.log('El total del vector proyectos es: '+vectorProyectos.length);
		
		for (var i=0;i<vectorProyectos.length;i++){
			
			console.log('hola'+vectorProyectos[i].id);
		
			for (var key in vectorProyectos[i].imagenesListado){
				
				console.log('salida: '+vectorProyectos[i].imagenesListado[key]);
				
			}
			
			
		}
		
		
	}// End function
	
	// Leer vector fotos
	function cargarFotos(){
		
		// var
		var url = '';
		var nombre = '';
		var contadorImagenes    = 0;
		var contadorProyecto    = 0;
		
		//$('#ajaxLoader').css('display','block');
		
		for (var key in vectorProyectos[0].imagenesCabecera){
			
			if (vectorProyectos[0].imagenesCabecera[key] != ''){
				
				var url = vectorProyectos[0].imagenesCabecera[key];
				var img = new Image();
				img.src = vectorProyectos[0].imagenesCabecera[key];
				img.width = 80;
				img.height = 40;
				
				//vectorObjetoFotos.push(img);
				vectorObjetos[key].img = img;
				
				//console.log('La url del objeto es: '+vectorProyectos[idSeleccionado].imagenesListado[key]);
				
				img.onload = function(){
				
					if (contadorImagenes >= 7 ){
						
						/*
						console.log('Acaba de cargar las fotos: '+contadorImagenes);
						$('#ajaxLoader').css('display','none');
						desplazaPaloDebajoDeFotos();
						crearEventosFotos();
						evaluarSeccion();
						eventThrowMouse('start');
						*/
					
						//keepAnglesInObject();
						//draw();
						//anim.start();
						//drawFrame();
						
						anim.start();
						
					}	
					
					contadorImagenes++;
					
				}// End function	
				
				//console.log('La url es: '+img.src);
		
				
				img.onerror = function(){
					
					//console.log('Ha habido un error y el contador esta en: '+contadorImagenes);
					
				}
				
			}	// if
				
			contadorProyecto++;
			
		} // for
		
		
		//console.log('objeto Fotos: '+vectorObjetoFotos);
		
		
	}		
	
	/*
	function drawFrame () {
		
		window.requestAnimationFrame(drawFrame, canvas);
		context.clearRect(0, 0, canvas.width, canvas.height);
		
		circumferencia();
		
	}
	*/
	
	//drawFrame();	
	
	
}
</script>
</body>
</html>